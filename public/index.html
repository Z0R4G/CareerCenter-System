<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerConnect+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.12.0/cdn.min.js" defer></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#841327',
                        secondary: '#a31e23',
                        catdark: '#2b2b2b',
                        catlight: '#fad129',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styling for the select dropdown */
        .custom-select {
            /* Hide default browser arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            /* Add custom SVG arrow using base64 for portability */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.23 7.21a.75.75 0 011.06.02L10 10.78l3.71-3.55a.75.75 0 111.02 1.08l-4.25 4a.75.75 0 01-1.02 0l-4.25-4a.75.75 0 01.02-1.06z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
    </style>
</head>

<body class="bg-gray-100 font-sans flex flex-col min-h-screen">
    <div class="flex-grow flex items-center justify-center py-6 sm:py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-6xl w-full space-y-6 sm:space-y-8 flex flex-col md:flex-row gap-6 sm:gap-8">
            <div class="flex-1 flex flex-col justify-center">
                <div class="text-center md:text-left">
                    <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-primary mb-3 sm:mb-4">CareerConnect+</h1>
                    <h2 class="text-xl sm:text-2xl text-gray-600 mb-4 sm:mb-6">MSU-IIT Career Center</h2>
                    <p class="text-base sm:text-lg text-gray-500 mb-6 sm:mb-8">Set an appointment for interviews, practices, and trainings
                        with the best counselors to talk about your future career!</p>
                </div>
            </div>

            <div class="flex-1" x-data="{ isLogin: true }">
                <div class="bg-white py-6 sm:py-8 px-4 sm:px-6 shadow rounded-lg lg:px-10">

                    <div class="flex border-b border-gray-200 mb-6">
                        <button @click="isLogin = true"
                            :class="isLogin ? 'border-b-2 border-primary text-primary' : 'text-gray-500'"
                            class="flex-1 py-2 text-center font-medium">
                            Login
                        </button>
                        <button @click="isLogin = false"
                            :class="!isLogin ? 'border-b-2 border-primary text-primary' : 'text-gray-500'"
                            class="flex-1 py-2 text-center font-medium">
                            Sign Up
                        </button>
                    </div>

                    <form x-show="isLogin" class="space-y-6" id="login-form">

                        <div>
                            <label for="role" class="block text-sm font-medium text-gray-700">Login Role</label>
                            <div class="mt-1">
                                <select id="role" name="role" required
                                    class="custom-select w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                                    <option value="student">Student</option>
                                    <option value="counselor">Counselor</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">MSU-IIT Email</label>
                            <div class="mt-1">
                                <input id="email" name="email" type="text" autocomplete="username" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                            </div>
                        </div>
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                            <div class="mt-1">
                                <input id="password" name="password" type="password" autocomplete="current-password"
                                    required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                            </div>
                        </div>

                        <div>
                            <button type="submit"
                                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                Sign in
                            </button>
                        </div>

                        <div class="text-center flex flex-col sm:flex-row sm:space-x-4 space-y-2 sm:space-y-0">
                            <button type="button" id="demo-student-btn" class="mt-2 text-sm text-primary underline">Use
                                Student Demo</button>
                            <button type="button" id="demo-counselor-btn"
                                class="mt-2 text-sm text-secondary underline">Use Counselor Demo</button>
                        </div>

                    </form>
                    <script>
                        // --- Helper function for actual login ---
                        async function handleLogin(role) {
                            const email = document.getElementById('email').value.trim();
                            const password = document.getElementById('password').value;

                            if (!email || !password) {
                                alert('Please enter both email and password.');
                                return;
                            }

                            // Added a specific error for unhandled demo accounts 
                            if ((email === 'demo@msuiit.edu.ph' && role !== 'student') || (email === 'counselor@msuiit.edu.ph' && role !== 'counselor')) {
                                alert(`Demo account '${email}' requires the role '${role}' to be selected.`);
                                return;
                            }

                            const roleSelected = document.getElementById('role').value;

                            if (roleSelected === 'counselor') {
                                try{
                                    // Send the selected role along with credentials
                                    const response = await fetch('/app/counselor/login', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({ email, password })
                                    });

                                    const data = await response.json();
                                    console.log('Login response:', data);

                                    if (response.ok && data.user) {
                                        localStorage.setItem('user', JSON.stringify(data.user));
                                        window.location.href = 'dashboard_counselor.html';
                                    } else {
                                        alert(data.error || 'Counselor login failed. Please check your credentials and selected role.');
                                    }
                                } catch (error) {
                                    console.error('Counselor Login error:', error);
                                    alert('An error occurred during counselor login. The server might be unreachable.');
                                }

                            }
                            else if (roleSelected === 'student') {
                                try {
                                    // Send the selected role along with credentials
                                    const response = await fetch('/app/login', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({ email, password})
                                    });

                                    const data = await response.json();
                                    console.log('Login response:', data);

                                    if (response.ok && data.user) {
                                        localStorage.setItem('user', JSON.stringify(data.user));

                                            window.location.href = 'dashboard_student.html';
          
                                    } else {
                                        alert(data.error || 'Login failed. Please check your credentials and selected role.');
                                    }
                                } catch (error) {
                                    console.error('Login error:', error);
                                    alert('An error occurred during login. The server might be unreachable.');
                                }
                            }else{
                                alert('error');
                            }


                        }

                        // --- Form Submission Listener (Captures role from dropdown) ---
                        document.getElementById('login-form').addEventListener('submit', function (e) {
                            e.preventDefault();
                            // Get the selected role from the dropdown
                            const selectedRole = document.getElementById('role').value;
                            handleLogin(selectedRole);
                        });


                        // --- Demo Login Logic (Updated to use the dropdown logic) ---

                        // STUDENT Demo Button
                        document.getElementById('demo-student-btn').addEventListener('click', function () {
                            const demoUser = {
                                id: '999',
                                first_name: 'Demo',
                                last_name: 'Student',
                                email: 'demo@msuiit.edu.ph',
                                ID_number: '2022-1001',
                                Year: '3rd Year',
                                program: 'BS Computer Science',
                                gender: 'Male',
                                role: 'student'
                            };
                            localStorage.setItem('user', JSON.stringify(demoUser));
                            document.getElementById('role').value = 'student'; // Set dropdown
                            document.getElementById('email').value = demoUser.email;
                            document.getElementById('password').value = 'demo1234';
                            window.location.href = 'dashboard_student.html';
                        });

                        // COUNSELOR Demo Button
                        document.getElementById('demo-counselor-btn').addEventListener('click', function () {
                            const demoUser = {
                                id: '501',
                                first_name: 'Counselor',
                                last_name: 'Adviser',
                                email: 'counselor@msuiit.edu.ph',
                                ID_number: 'C-001',
                                department: 'Career Center',
                                profile_link: 'https://cdn.pixabay.com/photo/2020/07/01/12/58/icon-5359553_1280.png',
                                role: 'counselor'
                            };
                            localStorage.setItem('user', JSON.stringify(demoUser));
                            document.getElementById('role').value = 'counselor'; // Set dropdown
                            document.getElementById('email').value = demoUser.email;
                            document.getElementById('password').value = 'demo1234';
                            window.location.href = 'dashboard_counselor.html';
                        });
                    </script>

                    <div x-show="!isLogin" class="space-y-6">
                        <p class="text-center text-sm text-gray-600">
                            Create your MICC account to connect with the counselors.
                        </p>
                        <a href="register.html"
                            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-secondary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary">
                            Create New Account
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-white py-6 w-full">
        <div class="max-w-6xl mx-auto px-4 text-center text-gray-500">
            <p>Â© 2025 MICC - Exclusive system for MSU-IIT's counselors and students.</p>
        </div>
    </footer>
</body>

</html>